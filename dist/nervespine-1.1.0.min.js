!function(e,t,r){var n={configs:{cacheContent:!1,baseContentUrl:"",pageSelector:"",linkSelector:""},Helper:function(e){if(!e.name)throw Error("Helper requires a name");if(!e[e.name])throw Error('Helper requires a "'+e.name+'" function');return r.registerHelper(e.name,e[e.name]),e},Partial:function(e){return o.init(e),r.registerPartial(e.name,e.content?e.template(e.content):e.template),e},Region:function(e){if(e.route)throw Error("Region should not have routes");if(!e.selector)throw Error("Region requires a selector");return e.$el=t(e.selector),o.init(e),i.init(e),a.init(e),0===e.$el.length?o.regions[e.selector]=e:e.render(),e},Page:function(e){if(e.selector=e.selector||this.configs.pageSelector,!e.selector)throw Error("Page requires a selector");if(!e.route)throw Error("Page requires one or more routes");if(e.$el=t(e.selector),0===e.$el.length)throw Error('Page element "'+e.selector+'" does not exist');return o.init(e),i.init(e),a.init(e),s.add(e),e}},i={init:function(e){e.fetch||(e.fetch=i.fetch)},fetch:function(){t.get(n.configs.baseContentUrl+s.parse(this.urls.content),function(e){this.content=e,this.render()}.bind(this))}},o={regions:{},init:function(e){if(!e.template)throw Error("Page, Region and Partial requires a template");if("string"==typeof e.template){if(!r.compile)throw Error("Full version of Handlebars is required if templates are not precompiled");e.template=r.compile(e.template)}e.render||(e.render=o.render)},render:function(){if(this.urls&&this.urls.content&&!this.content)return this.fetch();this.$el.html(this.template(this.content)).css("visibility","visible"),n.configs.cacheContent===!1&&this.urls&&this.urls.content&&(this.content=""),a.show(this),a.delegate(this);for(var e in o.regions){var r=o.regions[e];this.selector!=e&&t(e).length&&(r.$el=t(e),r.render())}}},s={routes:{},params:{},parse:function(e){if(0===e.indexOf("{{"))return e;for(var t in this.params)e=e.replace("{{"+t+"}}",this.params[t]);return e},add:function(e){if("string"==typeof e.route)this.routes[e.route]=e;else if(t.isArray(e.route))for(var r in e.route)this.routes[e.route[r]]=e;else console.warn("Invalid route "+e.route)},match:function(e){var t,r,n,i={};if(!e)return console.warn("Path is required");n=e.split("/").filter(Boolean);for(var o in this.routes)if(r=o.split("/").filter(Boolean),r.length==n.length){for(var s=0,a=!0;s<r.length;s++){if(-1==r[s].indexOf("{{")&&r[s]!=n[s]){a=!1;break}r[s]!=n[s]&&(t=r[s].replace("{{","").replace("}}",""),i[t]=n[s])}if(a)return Object.keys(i).length&&(this.routes[o].params=i),this.routes[o]}return!1},go:function(e){var t=s.match(e);t&&(history.pushState({},"",e),t.render())}},a={init:function(e){e.events&&e.events.init&&e[e.events.init]&&e[e.events.init]()},show:function(e){e.events&&e.events.show&&e[e.events.show]&&e[e.events.show](e.params)},link:function(){n.configs.linkSelector&&t(document).on("click",n.configs.linkSelector,function(e){e.preventDefault();var r=t(e.currentTarget).attr("href");r&&s.go(r)})},delegate:function(e){for(var r in e.events){var n=r.indexOf(" ");if(-1!=n){var i=r.slice(0,n),o=r.slice(n+1),s=e[e.events[r]];e.route?(e.$el.data("nsevent")&&t(document).off(e.$el.data("nsevent")),i=i+".ev"+Date.now(),e.$el.data("nsevent",i),t(document).on(i,o,s.bind(e))):e.$el.on(i,o,s.bind(e))}}}};t(document).ready(function(){if(!r||!t)throw Error("jQuery and Handlebars are required!");a.link(),s.go(location.pathname)}),e.Nervespine=n,e.Nervespine.go=s.go}(window,jQuery,Handlebars);