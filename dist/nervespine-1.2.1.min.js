!function(e,r,t){var n={configs:{cacheContent:!0,baseContentUrl:"",basePersistUrl:"",pageSelector:"",linkSelector:""},Helper:function(e){if(!e.name)throw Error("Helper requires a name");if(!e[e.name])throw Error('Helper requires a "'+e.name+'" function');return t.registerHelper(e.name,e[e.name]),e},Partial:function(e){if(!e.name)throw Error("Partial requires a name");return o.init(e),t.registerPartial(e.name,e.content?e.template(e.content):e.template),e},Region:function(e){if(!e.selector)throw Error("Region requires a selector");return e.$el=r(e.selector),o.init(e),i.init(e),a.trigger(e,"init"),0===e.$el.length?o.regions[e.selector]=e:e.render(),e},Page:function(e){if(e.selector=e.selector||this.configs.pageSelector,!e.selector)throw Error("Page requires a selector");if(!e.route)throw Error("Page requires one or more routes");if(e.$el=r(e.selector),0===e.$el.length)throw Error('Page element "'+e.selector+'" does not exist');return o.init(e),i.init(e),s.add(e),a.trigger(e,"init"),e}},i={init:function(e){e.fetch||(e.fetch=i.fetch),e.persist||(e.persist=i.persist)},fetch:function(){return r.get(n.configs.baseContentUrl+s.parse(this.urls.content),function(e){this.content=e,this.render()}.bind(this)).fail(function(e,r,t){a.trigger(this,"error",arguments),console.warn(t,this.urls.content)}.bind(this))},persist:function(e){if(!this.urls||!this.urls.persist)throw Error("Persist requires a url");return r.post(n.configs.basePersistUrl+s.parse(this.urls.persist),e||this.content).fail(function(e,r,t){a.trigger(this,"error",arguments),console.warn(t,this.urls.persist)}.bind(this))}},o={regions:{},init:function(e){if(!e.template)throw Error("Page, Region and Partial requires a template");if("string"==typeof e.template){if(!t.compile)throw Error("Full version of Handlebars is required if templates are not precompiled");e.template=t.compile(e.template)}e.render||(e.render=o.render)},render:function(){if(this.urls&&this.urls.content&&!this.content)return this.fetch();a.trigger(this,"parse"),this.$el.html(this.template(this.content)).css("visibility","visible"),n.configs.cacheContent===!1&&this.urls&&this.urls.content&&(this.content=""),a.delegate(this),a.trigger(this,"show");for(var e in o.regions){var t=o.regions[e];this.selector!=e&&r(e).length&&(t.$el=r(e),t.render())}}},s={routes:{},params:{},parse:function(e){if(0===e.indexOf("{{"))return e;for(var r in this.params)e=e.replace("{{"+r+"}}",this.params[r]);return e},add:function(e){if("string"==typeof e.route)this.routes[e.route]=e;else if(r.isArray(e.route))for(var t in e.route)this.routes[e.route[t]]=e;else console.warn("Invalid route "+e.route)},match:function(e){var r,t,n,i={};if(!e)return console.warn("Path is required");n=e.split("/").filter(Boolean);for(var o in this.routes)if(t=o.split("/").filter(Boolean),t.length==n.length){for(var s=0,a=!0;s<t.length;s++){if(-1==t[s].indexOf("{{")&&t[s]!=n[s]){a=!1;break}t[s]!=n[s]&&(r=t[s].replace("{{","").replace("}}",""),i[r]=n[s])}if(a)return Object.keys(i).length&&(this.routes[o].params=i),this.routes[o]}return this.routes["*"]?this.routes["*"]:!1},go:function(e){var r=s.match(e);r?(history.pushState({},"",e),a.trigger(r,"match",e),r.render()):console.warn("No route found for path "+e)}},a={trigger:function(e,r,t){var n=this.handler(e,r);n&&n.bind(e)(t)},handler:function(e,r){if(!e.events||!r)return!1;var t=e.events[r];if(!t)return!1;if("function"==typeof t)return t;var n=e[t];return"string"==typeof t&&"function"==typeof n?n:console.warn("Invalid handler for event",r)},link:function(){n.configs.linkSelector&&r(document).on("click",n.configs.linkSelector,function(e){e.preventDefault();var t=r(e.currentTarget).attr("href");t&&s.go(t)})},delegate:function(e){e.$el.off("."+e.selector);for(var t in e.events){var n=t.indexOf(" ");if(-1!=n){var i=t.slice(0,n),o=t.slice(n+1),s=this.handler(e,t);if(!s)continue;var a={document:document,window:window,body:"body",html:"html"};a[o]?r(a[o])[i](s.bind(e)):e.$el.on(i+"."+e.selector,e.selector==o?null:o,s.bind(e))}}}};r(document).ready(function(){if(!t||!r)throw Error("jQuery and Handlebars are required!");a.link(),s.go(location.pathname)}),e.Nervespine=n,e.Nervespine.go=s.go}(window,jQuery,Handlebars);